---
- hosts: localhost
  become: yes
  connection: local
  gather_facts: yes
  vars:
    apnscp_user_defaults: /root/apnscp-ansible-defaults.yml
  vars_files:
    - 'apnscp-vars.yml'
    - 'roles/common/vars/apnscp-internals.yml'
    - ['{{ apnscp_user_defaults }}', '/dev/null']
  roles:
    - filesystem/make-mounts
    - filesystem/separate-mtab
    - system/selinux
    - epel
    - systemd/mask-services
    - packages/install
    - pgsql/install
    - mysql/install    
    - system/rsyslog
    - vsftpd/configure
    #- mail/configure-dovecot
    - mail/configure-postfix
    - mail/configure-courier-authlib
    - mail/maildir
    - browscap
    - php/install  
    - php/install-pecl-module
    - php/create-configuration
    - java/tomcat
    - apnscp/bootstrap
    - apache/configure
    #- clamav/configure
    #- apache/modsecurity
    - apnscp/initialize-db
    - apnscp/build-php
    - apnscp/install-extensions  
    - apnscp/install-vendor-library
    # Checkpoint: admin should work fine at this point
    - apnscp/create-admin
    - apnscp/assert-admin-works
    # Onto provisioning a test account
    - apnscp/initialize-filesystem-template
    - apnscp/install-services
    - system/nscd
    - system/nss
    - system/pam
    #- system/limits
    - fail2ban/whitelist-self
    - fail2ban/configure-jails
    #- mail/globalize-spamassassin-bayes
    #- network/setup-firewall    
    - apnscp/register-ssl
    - network/optimizations
    # Odds and ends
    - system/yum
    #- mysql/phpmyadmin
    #- pgsql/phppgadmin
    #- mail/webmail-squirrelmail
    #- mail/webmail-roundcube
    #- mail/webmail-horde
    #- software/pyenv
    #- software/rvm
    #- software/nvm
    #- software/gvm
    #- software/passenger
    # Last checkpoint, validate a mock account
    #- apnscp/assert-account-works
    #- apnscp/notify-installed
    # Holy shit, DONE!
    # üéâüôåüéäüç∫